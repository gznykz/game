(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{114:function(e,a){},116:function(e,a){},146:function(e,a,t){},147:function(e,a,t){},148:function(e,a,t){},149:function(e,a,t){},150:function(e,a,t){},159:function(e,a,t){},160:function(e,a,t){},161:function(e,a,t){},162:function(e,a,t){},163:function(e,a,t){},164:function(e,a,t){},165:function(e,a,t){"use strict";t.r(a);var n=t(0),l=t.n(n),r=t(40),c=t.n(r),s=t(14),o=t(18),i="SET_USER",u={name:"",win_count:0,lost_count:0,game:null},m=Object(o.b)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case i:return Object.assign({},e,{name:"undefined"===typeof a.name?e.name:a.name,win_count:a.win_count||u.win_count,lost_count:a.lost_count||u.lost_count,game:a.game||u.game});default:return e}}}),d=o.c.apply(void 0,[]),p=Object(o.d)(m,{},d),h=(t(89),t(90),t(3)),E=t(4),v=t(7),f=t(6),b=t(8),y=t(2),g=function(){function e(){Object(h.a)(this,e)}return Object(E.a)(e,null,[{key:"setUser",value:function(e){var a=e.name,t=e.win_count,n=e.lost_count,l=e.game;return{type:i,name:a,win_count:t,lost_count:n,game:l}}}]),e}(),N=t(26),O=t.n(N),C=t(43),j=t(31),k=t(78),w=t.n(k);function S(e,a){return _.apply(this,arguments)}function _(){return(_=Object(C.a)(O.a.mark(function e(a,t){var n,l,r,c,s;return O.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=localStorage.getItem("cardgame_key"),l=new j.JsonRpc("https://api-kylin.eoslaomao.com"),r=new w.a([n]),c=new j.Api({rpc:l,signatureProvider:r,textDecoder:new TextDecoder,textEncoder:new TextEncoder}),e.prev=4,e.next=7,c.transact({actions:[{account:"cardgamecont",name:a,authorization:[{actor:localStorage.getItem("cardgame_account"),permission:"active"}],data:t}]},{blocksBehind:3,expireSeconds:30});case 7:return s=e.sent,e.abrupt("return",s);case 11:throw e.prev=11,e.t0=e.catch(4),e.t0;case 14:case"end":return e.stop()}},e,null,[[4,11]])}))).apply(this,arguments)}var I=function(){function e(){Object(h.a)(this,e)}return Object(E.a)(e,null,[{key:"getCurrentUser",value:function(){return new Promise(function(e,a){if(!localStorage.getItem("cardgame_account"))return a();S("login",{username:localStorage.getItem("cardgame_account")}).then(function(){e(localStorage.getItem("cardgame_account"))}).catch(function(e){localStorage.removeItem("cardgame_account"),localStorage.removeItem("cardgame_key"),a(e)})})}},{key:"login",value:function(e){var a=e.username,t=e.key;return new Promise(function(e,n){localStorage.setItem("cardgame_account",a),localStorage.setItem("cardgame_key",t),S("login",{username:a}).then(function(){e()}).catch(function(e){localStorage.removeItem("cardgame_account"),localStorage.removeItem("cardgame_key"),n(e)})})}},{key:"startGame",value:function(){return S("startgame",{username:localStorage.getItem("cardgame_account")})}},{key:"playCard",value:function(e){return S("playcard",{username:localStorage.getItem("cardgame_account"),player_card_idx:e})}},{key:"nextRound",value:function(){return S("nextround",{username:localStorage.getItem("cardgame_account")})}},{key:"endGame",value:function(){return S("endgame",{username:localStorage.getItem("cardgame_account")})}},{key:"getUserByName",value:function(){var e=Object(C.a)(O.a.mark(function e(a){var t,n;return O.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=new j.JsonRpc("https://api-kylin.eoslaomao.com"),e.next=4,t.get_table_rows({json:!0,code:"cardgamecont",scope:"cardgamecont",table:"users",limit:1,lower_bound:a});case 4:return n=e.sent,e.abrupt("return",n.rows[0]);case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}},e,null,[[0,8]])}));return function(a){return e.apply(this,arguments)}}()}]),e}(),P=function(e){function a(e){var t;return Object(h.a)(this,a),(t=Object(v.a)(this,Object(f.a)(a).call(this,e))).state={loading:!0},t.getCurrentUser=t.getCurrentUser.bind(Object(y.a)(Object(y.a)(t))),t.getCurrentUser(),t}return Object(b.a)(a,e),Object(E.a)(a,[{key:"getCurrentUser",value:function(){var e=this,a=this.props.setUser;return I.getCurrentUser().then(function(e){a({name:e})}).catch(function(){}).finally(function(){e.setState({loading:!1})})}},{key:"render",value:function(){var e=this.state.loading,a=this.props.user,t=a.name,n=a.game,r="login";return n&&0!==n.status?r="game-ended":n&&n.selected_card_ai>0?r="card-selected":n&&17!==n.deck_ai.length?r="started":t&&(r="profile"),l.a.createElement("div",{className:"App status-".concat(r).concat(e?" loading":"")},t&&l.a.createElement(z,null),!t&&l.a.createElement($,null))}}]),a}(n.Component),U={setUser:g.setUser},R=Object(s.b)(function(e){return e},U)(P),M=(t(146),function(e){function a(e){var t;return Object(h.a)(this,a),(t=Object(v.a)(this,Object(f.a)(a).call(this,e))).state={loading:!1},t.handleClick=t.handleClick.bind(Object(y.a)(Object(y.a)(t))),t}return Object(b.a)(a,e),Object(E.a)(a,[{key:"handleClick",value:function(){var e=this,a=this.props.onClick;this.setState({loading:!0});var t="function"===typeof a&&a();if(t&&"function"===typeof t.then)return t.then(function(){e.isComponentMounted&&e.setState({loading:!1})});this.isComponentMounted&&this.setState({loading:!1})}},{key:"componentDidMount",value:function(){this.isComponentMounted=!0}},{key:"componentWillUnmount",value:function(){this.isComponentMounted=!1}},{key:"render",value:function(){var e=this.props,a=e.className,t=e.type,n=e.style,r=e.children,c=this.state.loading;return c=c||this.props.loading,l.a.createElement("button",Object.assign({className:"Button".concat(a?" "+a:"").concat(c?" loading":""),onClick:this.handleClick},{type:t,style:n}),r)}}]),a}(n.Component)),A=(t(147),t(148),[[0,0],[1,1],[1,1],[1,2],[1,2],[1,3],[2,1],[2,1],[2,2],[2,2],[2,3],[3,1],[3,1],[3,2],[3,2],[3,3],[4,3],[5,0]]),x=function(e){function a(){return Object(h.a)(this,a),Object(v.a)(this,Object(f.a)(a).apply(this,arguments))}return Object(b.a)(a,e),Object(E.a)(a,[{key:"render",value:function(){var e=this.props,a=e.cardId,t=e.onClick,n=0!==a&&t?"a":"span",r="";switch(A[a][0]){case 1:r="FIRE";break;case 2:r="WOOD";break;case 3:r="WATER";break;case 4:case 5:r="SPECIAL";break;default:r="EMPTY"}return l.a.createElement(n,{className:"Card ".concat("type"+A[a][0]," ").concat("card"+a),onClick:t},l.a.createElement("span",{className:"type"},r),l.a.createElement("span",{className:"power"},0!==a&&A[a][1]))}}]),a}(n.Component),T=(t(149),t(150),t(44)),G=t.n(T);G.a.setAppElement("#root");var L=function(e){function a(){var e;return Object(h.a)(this,a),(e=Object(v.a)(this,Object(f.a)(a).call(this))).state={modalIsOpen:!1},e.openModal=e.openModal.bind(Object(y.a)(Object(y.a)(e))),e.closeModal=e.closeModal.bind(Object(y.a)(Object(y.a)(e))),e}return Object(b.a)(a,e),Object(E.a)(a,[{key:"openModal",value:function(){this.setState({modalIsOpen:!0})}},{key:"closeModal",value:function(){this.setState({modalIsOpen:!1})}},{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement(M,{onClick:this.openModal,className:"small blue"},"RULES"),l.a.createElement(G.a,{isOpen:this.state.modalIsOpen,onRequestClose:this.closeModal,className:"ModalContent",overlayClassName:"ModalOverlay"},l.a.createElement("div",{className:"RulesModal"},l.a.createElement("div",{className:"title"},"Rules"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("div",null,"Each player begins with an identical set of cards."),l.a.createElement("div",null,"Creature cards have two attributes:"),l.a.createElement("ol",null,l.a.createElement("li",null,"Power: 1, 2, or 3"),l.a.createElement("li",null,"Element: Wood, Fire, or Water")),l.a.createElement("div",null,"There are also 2 special cards:"),l.a.createElement("ol",null,l.a.createElement("li",null,"PACEHM card voids all results in a round"),l.a.createElement("li",null,"SILVRA card has a power of 3, but no elemental compatibility bonus"))),l.a.createElement("li",null,l.a.createElement("div",null,"At the start of the game decks are shuffled and each player draws 4 cards. Cards in hand are always face up.")),l.a.createElement("li",null,l.a.createElement("div",null,"Each round, players pick a card. Picks are revealed simultaneously."),l.a.createElement("div",{className:"divider top"}),l.a.createElement("dl",null,l.a.createElement("dt",null,"Score Calculations"),l.a.createElement("dd",null,l.a.createElement("p",{className:"calculation1"},l.a.createElement("span",{className:"power"},"Attack Power"),l.a.createElement("span",{className:"plus"},"+"),l.a.createElement("span",{className:"bonus"},"Elemental Compatibility Bonus")))),l.a.createElement("div",{className:"calculations"},l.a.createElement("div",{className:"calculation2"},l.a.createElement("div",{className:"description"},l.a.createElement("div",null,"Attack Power"),l.a.createElement("div",null,"The attack value shown on the Card"))),l.a.createElement("div",{className:"calculation3"},l.a.createElement("div",{className:"description"},l.a.createElement("div",null,"Elemental Compatibility Bonus"),l.a.createElement("div",null,"Player will gain 1 extra score when the player card's element type is stronger than the opponent's (Fire > Wood > Water > Fire > etc.). For Special Card 2 (SILVRA), no Elemental Compatibility Bonus is added"))),l.a.createElement("div",{className:"calculation4"},l.a.createElement("div",{className:"description"},l.a.createElement("div",null,"Special Card 1 (PACEHM)"),l.a.createElement("div",null,"This special 0 Attack Power card voids all results in a round"))),l.a.createElement("div",{className:"calculation5"},l.a.createElement("div",{className:"description"},l.a.createElement("div",null,"Special Card 2 (SILVRA)"),l.a.createElement("div",null,"This special 3 Attack Power card removes elemental compatibility bonus in a round")))),l.a.createElement("div",{className:"divider bottom"})),l.a.createElement("li",null,l.a.createElement("div",null,"The player with a higher score wins the round. The losing player loses HP equal to the difference in scores. For example, if Player A has a score of 3 and Player B has a score of 1, Player B will lose 2 HP.")),l.a.createElement("li",null,l.a.createElement("div",null,"The game ends when:"),l.a.createElement("ol",null,l.a.createElement("li",null,"A player has 0 or less HP. This player is the loser."),l.a.createElement("li",null,"All cards are played. The winner will be the player with the highest life total. If life totals are the same, the AI player wins."))))),l.a.createElement("div",{onClick:this.closeModal},l.a.createElement("i",{className:"ButtonClose"},"Close"))))}}]),a}(n.Component),D=function(e){function a(){return Object(h.a)(this,a),Object(v.a)(this,Object(f.a)(a).apply(this,arguments))}return Object(b.a)(a,e),Object(E.a)(a,[{key:"render",value:function(){var e=this.props,a=e.className,t=e.deckCardCount,n=e.handCardCount,r=e.onEndGame;return l.a.createElement("div",{className:"Info".concat(a?" "+a:"")},l.a.createElement("p",null,"ROUND ",l.a.createElement("span",{className:"round-number"},18-t-n,"/17")),l.a.createElement(L,null),l.a.createElement("div",null,l.a.createElement(M,{onClick:r,className:"small red"},"QUIT")))}}]),a}(n.Component),W=(t(159),function(e){function a(){return Object(h.a)(this,a),Object(v.a)(this,Object(f.a)(a).apply(this,arguments))}return Object(b.a)(a,e),Object(E.a)(a,[{key:"render",value:function(){var e=this.props,a=e.className,t=e.deckCardCount,n=e.aiLife,r=e.aiHandCards,c=e.aiName,s=e.playerLife,o=e.playerHandCards,i=e.playerName,u=e.onPlayCard;return l.a.createElement("table",{className:"GameMat".concat(a?" "+a:"")},l.a.createElement("tbody",null,l.a.createElement("tr",null,l.a.createElement("td",{className:"mat mat-ai"},l.a.createElement(H,{className:"ai",name:c,life:n}),l.a.createElement("div",{className:"deck ai remain".concat(t)},c,"'S Deck (",t,")"),l.a.createElement(B,{className:"ai",cards:r}))),l.a.createElement("tr",null,l.a.createElement("td",{className:"mat mat-player"},l.a.createElement(H,{className:"player",name:i,life:s}),l.a.createElement("div",{className:"deck player remain".concat(t)},i,"'S Deck (",t,")"),l.a.createElement(B,{className:"player",cards:o,onPlayCard:u})))))}}]),a}(n.Component)),B=(t(160),function(e){function a(){return Object(h.a)(this,a),Object(v.a)(this,Object(f.a)(a).apply(this,arguments))}return Object(b.a)(a,e),Object(E.a)(a,[{key:"render",value:function(){var e=this.props,a=e.className,t=e.cards,n=e.onPlayCard;return l.a.createElement("div",{className:"HandCards".concat(a?" "+a:"")},function(e){for(var a=[],t=function(t){var r={key:t,cardId:e[t]};n&&(r.onClick=function(){n(t)}),a.push(l.a.createElement(x,r))},r=0;r<4;++r)t(r);return a}(t))}}]),a}(n.Component)),H=(t(161),function(e){function a(){return Object(h.a)(this,a),Object(v.a)(this,Object(f.a)(a).apply(this,arguments))}return Object(b.a)(a,e),Object(E.a)(a,[{key:"render",value:function(){var e=this.props,a=e.className,t=e.name,n=e.life;return l.a.createElement("div",{className:"PlayerInfo".concat(a?" "+a:"")},l.a.createElement("div",{className:"name"},t),l.a.createElement("div",{className:"life life".concat(n)}),l.a.createElement("div",{className:"lifepoints"},n<0?0:n,"/5"))}}]),a}(n.Component)),F=(t(162),function(e){function a(){return Object(h.a)(this,a),Object(v.a)(this,Object(f.a)(a).apply(this,arguments))}return Object(b.a)(a,e),Object(E.a)(a,[{key:"render",value:function(){var e=this.props,a=e.name,t=e.winCount,n=e.lostCount,r=e.onStartGame;return l.a.createElement("div",{className:"PlayerProfile"},l.a.createElement("div",{className:"title"},"Elemental Battles - powered by EOSIO"),l.a.createElement("div",{className:"welcome"},l.a.createElement("span",null,"Welcome")),l.a.createElement("div",{className:"username"},l.a.createElement("span",null,a)),l.a.createElement("div",{className:"record"},l.a.createElement("p",null,"Your Current Record"),l.a.createElement("span",null,"Win ",l.a.createElement("span",{className:"count"},t)),l.a.createElement("span",null," | "),l.a.createElement("span",null,"Lost ",l.a.createElement("span",{className:"count"},n))),l.a.createElement("div",{className:"buttons"},l.a.createElement(M,{onClick:r,className:"green"},"START")))}}]),a}(n.Component)),V=(t(163),function(e){function a(){return Object(h.a)(this,a),Object(v.a)(this,Object(f.a)(a).apply(this,arguments))}return Object(b.a)(a,e),Object(E.a)(a,[{key:"render",value:function(){var e=this.props,a=e.aiCard,t=e.aiName,n=e.aiLost,r=e.playerCard,c=e.playerName,s=e.playerLost,o=e.status,i=e.onNextRound,u=e.onEndGame,m=a>0,d="",p="";return 0===n&&0===s?(d="DRAW",p="DRAW"):0===n?(d="WIN",p=l.a.createElement("span",null,"- ",s)):(d=l.a.createElement("span",null,"- ",n),p="WIN"),l.a.createElement("div",{className:"Resolution".concat(m?" card-selected":"")},l.a.createElement("div",null,1===o&&l.a.createElement("div",{className:"result win"},"VICTORY"),-1===o&&l.a.createElement("div",{className:"result lost"},"DEFEATED"),l.a.createElement("div",{className:"player"},l.a.createElement("p",{className:"round-result"},m&&p),l.a.createElement(x,{cardId:r}),l.a.createElement("p",{className:"name"},c)),l.a.createElement("div",{className:"vs"},"VS"),l.a.createElement("div",{className:"ai"},l.a.createElement("p",{className:"round-result"},m&&d),l.a.createElement(x,{cardId:a}),l.a.createElement("p",{className:"name"},t)),l.a.createElement("div",{className:"buttons"},m&&0===o&&l.a.createElement(M,{onClick:i},"NEXT ROUND"),m&&0!==o&&l.a.createElement(M,{onClick:u,className:"red"},"QUIT"))))}}]),a}(n.Component)),q=function(e){function a(e){var t;return Object(h.a)(this,a),(t=Object(v.a)(this,Object(f.a)(a).call(this,e))).state={loading:!0},t.loadUser=t.loadUser.bind(Object(y.a)(Object(y.a)(t))),t.handleStartGame=t.handleStartGame.bind(Object(y.a)(Object(y.a)(t))),t.handlePlayCard=t.handlePlayCard.bind(Object(y.a)(Object(y.a)(t))),t.handleNextRound=t.handleNextRound.bind(Object(y.a)(Object(y.a)(t))),t.handleEndGame=t.handleEndGame.bind(Object(y.a)(Object(y.a)(t))),t.loadUser(),t}return Object(b.a)(a,e),Object(E.a)(a,[{key:"loadUser",value:function(){var e=this,a=this.props,t=a.setUser,n=a.user.name;return I.getUserByName(n).then(function(a){t({win_count:a.win_count,lost_count:a.lost_count,game:a.game_data}),e.setState({loading:!1})})}},{key:"handleStartGame",value:function(){var e=this;return I.startGame().then(function(){return e.loadUser()})}},{key:"handlePlayCard",value:function(e){var a=this;if(0!==this.props.user.game.hand_player[e])return this.setState({loading:!0}),I.playCard(e).then(function(){return a.loadUser()})}},{key:"handleNextRound",value:function(){var e=this;return I.nextRound().then(function(){return e.loadUser()})}},{key:"handleEndGame",value:function(){var e=this;return I.endGame().then(function(){return e.loadUser()})}},{key:"render",value:function(){var e=this.state.loading,a=this.props.user,t=a.name,n=a.win_count,r=a.lost_count,c=a.game,s=c&&17!==c.deck_ai.length;return l.a.createElement("section",{className:"Game".concat(e?" loading":"")},s?l.a.createElement("div",{className:"container"},l.a.createElement(W,{deckCardCount:c.deck_ai.length,aiLife:c.life_ai,aiHandCards:c.hand_ai,aiName:"COMPUTER",playerLife:c.life_player,playerHandCards:c.hand_player,playerName:t,onPlayCard:this.handlePlayCard}),l.a.createElement(V,{status:c.status,aiCard:c.selected_card_ai,aiName:"COMPUTER",aiLost:c.life_lost_ai,playerCard:c.selected_card_player,playerName:t,playerLost:c.life_lost_player,onNextRound:this.handleNextRound,onEndGame:this.handleEndGame}),l.a.createElement(D,{deckCardCount:c.deck_ai.length,handCardCount:c.hand_ai.filter(function(e){return e>0}).length,onEndGame:this.handleEndGame})):l.a.createElement(F,{name:t,winCount:n,lostCount:r,onLogout:this.handleLogout,onStartGame:this.handleStartGame}),s&&e&&l.a.createElement("div",{className:"spinner"},l.a.createElement("div",{className:"image"}),l.a.createElement("div",{className:"circles"},l.a.createElement("div",{className:"circle"},l.a.createElement("div",{className:"inner"})),l.a.createElement("div",{className:"circle"},l.a.createElement("div",{className:"inner"})),l.a.createElement("div",{className:"circle"},l.a.createElement("div",{className:"inner"})),l.a.createElement("div",{className:"circle"},l.a.createElement("div",{className:"inner"})),l.a.createElement("div",{className:"circle"},l.a.createElement("div",{className:"inner"})))))}}]),a}(n.Component),J={setUser:g.setUser},z=Object(s.b)(function(e){return e},J)(q),Y=(t(164),t(25)),Q=t(79),K=function(e){function a(e){var t;return Object(h.a)(this,a),(t=Object(v.a)(this,Object(f.a)(a).call(this,e))).state={form:{username:"",key:"",error:""},isSigningIn:!1},t.handleChange=t.handleChange.bind(Object(y.a)(Object(y.a)(t))),t.handleSubmit=t.handleSubmit.bind(Object(y.a)(Object(y.a)(t))),t}return Object(b.a)(a,e),Object(E.a)(a,[{key:"handleChange",value:function(e){var a,t=e.target,n=t.name,l=t.value,r=this.state.form;this.setState({form:Object(Q.a)({},r,(a={},Object(Y.a)(a,n,l),Object(Y.a)(a,"error",""),a))})}},{key:"componentDidMount",value:function(){this.isComponentMounted=!0}},{key:"componentWillUnmount",value:function(){this.isComponentMounted=!1}},{key:"handleSubmit",value:function(e){var a=this;e.preventDefault();var t=this.state.form,n=this.props.setUser;return this.setState({isSigningIn:!0}),I.login(t).then(function(){n({name:t.username})}).catch(function(e){a.setState({error:e.toString()})}).finally(function(){a.isComponentMounted&&a.setState({isSigningIn:!1})})}},{key:"render",value:function(){var e=this.state,a=e.form,t=e.error,n=e.isSigningIn;return l.a.createElement("div",{className:"Login"},l.a.createElement("div",{className:"title"},"Elemental Battles - powered by EOSIO"),l.a.createElement("div",{className:"description"},"Please use the Account Name and Private Key generated in the previous page to log into the game."),l.a.createElement("form",{name:"form",onSubmit:this.handleSubmit},l.a.createElement("div",{className:"field"},l.a.createElement("label",null,"Account name"),l.a.createElement("input",{type:"text",name:"username",value:a.username,placeholder:"All small letters, a-z, 1-5 or dot, max 12 characters",onChange:this.handleChange,pattern:"[\\.a-z1-5]{2,12}",required:!0})),l.a.createElement("div",{className:"field"},l.a.createElement("label",null,"Private key"),l.a.createElement("input",{type:"password",name:"key",value:a.key,onChange:this.handleChange,pattern:"^.{51,}$",required:!0})),l.a.createElement("div",{className:"field form-error"},t&&l.a.createElement("span",{className:"error"},t)),l.a.createElement("div",{className:"bottom"},l.a.createElement(M,{type:"submit",className:"green",loading:n},"CONFIRM"))))}}]),a}(n.Component),X={setUser:g.setUser},$=Object(s.b)(function(e){return e},X)(K);c.a.render(l.a.createElement(s.a,{store:p},l.a.createElement(R,null)),document.getElementById("root"))},80:function(e,a,t){e.exports=t(165)},89:function(e,a,t){},90:function(e,a,t){}},[[80,1,2]]]);
//# sourceMappingURL=main.398ebfa5.chunk.js.map